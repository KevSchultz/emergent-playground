<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: frontend/src/sketches/TextureRuleCellularAutomataSketchClass.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: frontend/src/sketches/TextureRuleCellularAutomataSketchClass.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import CellularAutomataSketchClass from "./CellularAutomataSketchClass";

const PIXEL_DENSITY = 1;

/**
 * @class TextureRuleCellularAutomataSketchClass
 * @classdesc Extends CellularAutomataSketchClass to implement a texture-based rule for cellular automata.
 * This class introduces the concept of states and neighbors into the cellular automata, allowing for more complex patterns and behaviors.
 * It randomly generates states and rules for cellular automata, then applies these by passing a texture to the shader.
 * The class is designed for use with p5.js and integrates seamlessly with React through the ReactP5Wrapper component, allowing for dynamic property updates and interactive sketch manipulation.
 * @property {number} numberOfStates - The number of unique states each cell can have.
 * @property {number} numberOfNeighbors - The number of neighbors considered for each cell's next state.
 * @property {p5.Graphics} ruleGraphics - A p5.js graphics buffer storing the visualization of the rule set.
 * @property {p5.Graphics} statesGraphics - A p5.js graphics buffer for visual representation of each state.
 * @property {Array.&lt;p5.Color>} states - An array of p5.js color objects representing the color of each state.
 * @constructor
 * @param {Object} defaultReactProperties - Initial properties for the sketch, typically passed from a React component.
 */
class TextureRuleCellularAutomataSketchClass extends CellularAutomataSketchClass {
  constructor(defaultReactProperties) {
    super(defaultReactProperties);

    this.numberOfStates = 4;
    this.numberOfNeighbors = 4;
    this.generation = 0;
    this.ruleGraphics;
    this.statesGraphics;
    this.states;
    this.random = Math.random();

    // bind the this to methods
    this.generateRandomStates = this.generateRandomStates.bind(this);
    this.setupStateGraphics = this.setupStateGraphics.bind(this);
    this.setupRuleGraphics = this.setupRuleGraphics.bind(this);
    this.generateRandomRuleGraphics =
      this.generateRandomRuleGraphics.bind(this);
    this.generateIsomorphicRuleGraphics =
      this.generateIsomorphicRuleGraphics.bind(this);
    this.setup = this.setup.bind(this);
    this.draw = this.draw.bind(this);
    this.setupCurrentStateGraphicsBuffer =
      this.setupCurrentStateGraphicsBuffer.bind(this);
    this.updateWorldWidth = this.updateWorldWidth.bind(this);
    this.updateWorldHeight = this.updateWorldHeight.bind(this);
    this.generateRule30 = this.generateRule30.bind(this);
  }

  /**
   * Generates random states for the sketch.
   *
   * This method clears the current states array and then fills it with new random colors.
   * Each color is a p5 color object with random red, green, and blue values and an alpha value of 255.
   */
  generateRandomStates() {
    this.states = [];

    for (let i = 0; i &lt; this.numberOfStates; i++) {
      const red = Math.floor(Math.random() * 255);
      const green = Math.floor(Math.random() * 255);
      const blue = Math.floor(Math.random() * 255);
      const alpha = 255;

      this.states.push(this.p5.color(red, green, blue, alpha));
    }
  }

  generateRule30() {
    this.ruleGraphics = this.p5.createGraphics(8, 1);

    this.ruleGraphics.loadPixels();
    for (let i = 0; i &lt; 8; i++) {
      let randomState = this.states[i % 2];

      this.ruleGraphics.set(i, 0, randomState);
    }
    this.ruleGraphics.updatePixels();
  }

  /**
   * Generates random rule graphics for the sketch.
   *
   * This method creates a new p5 graphics object with a width equal to the number of states raised to the power of the number of neighbors plus one and a height of one.
   * It then fills the graphics object with random states.
   */
  generateRandomRuleGraphics() {
    let width = Math.pow(this.numberOfStates, this.numberOfNeighbors + 1);

    this.ruleGraphics = this.p5.createGraphics(width, 1);

    this.ruleGraphics.loadPixels();
    for (let i = 0; i &lt; width; i++) {
      let randomState =
        this.states[this.p5.floor(this.p5.random() * this.numberOfStates)];

      this.ruleGraphics.set(i, 0, randomState);
    }
    this.ruleGraphics.updatePixels();
  }

  reflectNumber(num, base) {
    let stringNumber = num.toString(base);

    let reflectedNumber = 0;

    for (let i = 0; i &lt; stringNumber.length; i++) {
      reflectedNumber += parseInt(stringNumber[i]) * Math.pow(base, i);
    }

    return reflectedNumber;
  }

  /**
   * Generates random isomorphic rule graphics for the sketch.
   *
   * This method creates a new p5 graphics object with a width equal to the number of states raised to the power of the number of neighbors plus one and a height of one.
   * It then fills the graphics object with random states in a symmetrical pattern.
   */
  generateIsomorphicRuleGraphics() {
    let width = Math.pow(this.numberOfStates, this.numberOfNeighbors + 1);

    this.ruleGraphics = this.p5.createGraphics(width, 1);

    this.ruleGraphics.loadPixels();
    let midPoint = Math.floor(width / 2);
    for (let i = 0; i &lt;= midPoint; i++) {
      let randomState =
        this.states[this.p5.floor(this.p5.random() * this.numberOfStates)];

      let reflectedNumber = this.reflectNumber(i, this.numberOfStates);

      // Set the state at the current index and its mirror image
      this.ruleGraphics.set(i, 0, randomState);
      this.ruleGraphics.set(reflectedNumber, 0, randomState);

      console.log(
        i.toString(this.numberOfStates),
        reflectedNumber.toString(this.numberOfStates),
      );
    }
    this.ruleGraphics.updatePixels();
  }

  /**
   * Sets up the state graphics for the sketch.
   *
   * This method creates a new p5 graphics object with a width equal to the number of states and a height of one.
   * It then fills the graphics object with the colors of the states.
   */
  setupStateGraphics() {
    this.stateGraphics = this.p5.createGraphics(this.numberOfStates, 1);

    this.stateGraphics.loadPixels();
    for (let i = 0; i &lt; this.numberOfStates; i++) {
      this.stateGraphics.set(i, 0, this.states[i]);
    }
    this.stateGraphics.updatePixels();
  }

  /**
   * Sets up the rule graphics for the sketch.
   *
   * This method calls the generateRandomRuleGraphics method to create a new rule graphics.
   */
  setupRuleGraphics() {
    // this.generateRandomRuleGraphics();
    this.generateIsomorphicRuleGraphics();
  }

  /**
   * Updates the world width of the sketch.
   *
   * This method clears the current and previous states, sets the pause state to 1, updates the shader's resolution uniform, and resizes the canvas of the current and previous states.
   *
   * @param {number} newWorldWidth - The new world width.
   */
  updateWorldWidth(newWorldWidth) {
    this.currentState.clear();
    this.previousState.clear();
    this.reactProperties.setPause(1);
    this.shader.setUniform("pause", 1);
    this.shader.setUniform("resolution", [
      this.reactProperties.worldWidth,
      this.reactProperties.worldHeight,
    ]);
    this.currentState.resizeCanvas(
      newWorldWidth,
      this.reactProperties.worldHeight,
    );
    this.previousState.resizeCanvas(
      newWorldWidth,
      this.reactProperties.worldHeight,
    );

    this.currentState.background(this.states[0]);
    this.previousState.background(this.states[0]);

    this.generation = 0;

    this.debugMode
      ? console.log("CellularAutomataSketchClass.updateWorldWidth")
      : null;
  }

  /**
   * Updates the world height of the sketch.
   *
   * This method clears the current and previous states, sets the pause state to 1, updates the shader's resolution uniform, and resizes the canvas of the current and previous states.
   *
   * @param {number} newWorldHeight - The new world height.
   */
  updateWorldHeight(newWorldHeight) {
    this.currentState.clear();
    this.previousState.clear();
    this.reactProperties.setPause(1);
    this.shader.setUniform("pause", 1);
    this.shader.setUniform("resolution", [
      this.reactProperties.worldWidth,
      this.reactProperties.worldHeight,
    ]);
    this.currentState.resizeCanvas(
      this.reactProperties.worldWidth,
      newWorldHeight,
    );
    this.previousState.resizeCanvas(
      this.reactProperties.worldWidth,
      newWorldHeight,
    );

    this.currentState.background(this.states[0]);
    this.previousState.background(this.states[0]);

    this.generation = 0;

    this.debugMode
      ? console.log("CellularAutomataSketchClass.updateWorldHeight")
      : null;
  }

  /**
   * Sets up the current state graphics buffer which is eventually drawn as a texture to a plane in the main canvas.
   * @returns None
   */
  setupCurrentStateGraphicsBuffer(worldWidth, worldHeight) {
    this.currentState = this.p5.createGraphics(
      worldWidth,
      worldHeight,
      this.p5.WEBGL,
    );

    this.currentState.shader(this.shader);
    this.shader.setUniform("resolution", [worldWidth, worldHeight]);

    this.currentState.pixelDensity(PIXEL_DENSITY);
    this.currentState.background(this.states[0]);
  }

  /**
   * Sets up the sketch.
   *
   */
  setup() {
    this.generateRandomStates();

    super.setup();

    this.setupStateGraphics();

    this.setupRuleGraphics();
  }

  /**
   * Draws the sketch.
   *
   */
  draw() {
    // If the sketch is not set up, do nothing
    if (this.reactProperties.pause === 0) {
      this.generation += 1;
    }

    if (this.isSketchSetup == false) {
      return;
    }

    this.p5.clear();

    this.copyGraphicsBufferImageDataToAnotherGraphicsBuffer(
      this.previousState,
      this.currentState,
      0,
      0,
    );

    let mouseWorldLocation = this.screenToWorldP52DCoordinates(
      this.p5.mouseX,
      this.p5.mouseY,
    );
    let mouseWorldX = mouseWorldLocation.x;
    let mouseWorldY = mouseWorldLocation.y;

    this.brushDrawOnGraphics(
      this.previousState,
      mouseWorldX,
      mouseWorldY,
      this.states[1],
    );

    this.shader.setUniform("generation", this.generation);
    this.shader.setUniform("pause", this.reactProperties.pause);
    this.shader.setUniform("previousState", this.previousState);
    this.shader.setUniform("states", this.stateGraphics);
    this.shader.setUniform("rule", this.ruleGraphics);
    this.shader.setUniform("random", this.random);

    // shader is applied to the currentState by drawing a rectangle the size of the world
    this.currentState.rect(
      -this.reactProperties.worldWidth / 2,
      -this.reactProperties.worldHeight / 2,
      this.reactProperties.worldWidth,
      this.reactProperties.worldHeight,
    );

    this.p5.scale(this.reactProperties.zoom);

    // ----- Draw the CurrentState to the a Canvas Plane -----
    this.drawTexturePlane(
      this.currentState,
      this.reactProperties.worldWidth,
      this.reactProperties.worldHeight,
    );

    // Camera Settings
    this.p5.ortho();
    this.p5.camera(
      this.reactProperties.cameraX,
      this.reactProperties.cameraY,
      this.reactProperties.cameraZ,
      this.reactProperties.cameraX,
      this.reactProperties.cameraY,
      0,
      0,
      1,
      0,
    );
  }
}

export default TextureRuleCellularAutomataSketchClass;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="backend_src_application.module_js.html">backend/src/application.js</a></li><li><a href="backend_src_authentication.module_js.html">backend/src/authentication.js</a></li><li><a href="backend_src_jsonWebTokenAuthorize.module_js.html">backend/src/jsonWebTokenAuthorize.js</a></li><li><a href="backend_src_jsonWebTokenGenerator.module_js.html">backend/src/jsonWebTokenGenerator.js</a></li><li><a href="backend_src_mainAPIRoutes.module_js.html">backend/src/mainAPIRoutes.js</a></li><li><a href="backend_src_postgreSQLConnect.module_js.html">backend/src/postgreSQLConnect.js</a></li><li><a href="frontend_src_components_BackendRequester.module_js.html">frontend/src/components/BackendRequester.js</a></li><li><a href="frontend_src_components_BinaryEncoderDecoder.module_js.html">frontend/src/components/BinaryEncoderDecoder.js</a></li><li><a href="frontend_src_components_BrushIconButton.module_jsx.html">frontend/src/components/BrushIconButton.jsx</a></li><li><a href="frontend_src_components_DefaultProperties.module_jsx.html">frontend/src/components/DefaultProperties.jsx</a></li><li><a href="frontend_src_components_InputSlider.module_jsx.html">frontend/src/components/InputSlider.jsx</a></li><li><a href="frontend_src_components_LanguageColorMenuDropdown.module_jsx.html">frontend/src/components/LanguageColorMenuDropdown.jsx</a></li><li><a href="frontend_src_components_LanguageHelpDropdown.module_jsx.html">frontend/src/components/LanguageHelpDropdown.jsx</a></li><li><a href="frontend_src_components_LanguageOptionsDropdown.module_jsx.html">frontend/src/components/LanguageOptionsDropdown.jsx</a></li><li><a href="frontend_src_components_LanguageOptionsTabContainer.module_jsx.html">frontend/src/components/LanguageOptionsTabContainer.jsx</a></li><li><a href="frontend_src_components_LanguageShaderDropdown.module_jsx.html">frontend/src/components/LanguageShaderDropdown.jsx</a></li><li><a href="frontend_src_components_LanguageStateItem.module_jsx.html">frontend/src/components/LanguageStateItem.jsx</a></li><li><a href="frontend_src_components_LeftButtonListContainer.module_jsx.html">frontend/src/components/LeftButtonListContainer.jsx</a></li><li><a href="frontend_src_components_LoadingDialog.module_jsx.html">frontend/src/components/LoadingDialog.jsx</a></li><li><a href="frontend_src_components_LoginLink.module_jsx.html">frontend/src/components/LoginLink.jsx</a></li><li><a href="frontend_src_components_LogoutLink.module_jsx.html">frontend/src/components/LogoutLink.jsx</a></li><li><a href="frontend_src_components_P5Background.module_jsx.html">frontend/src/components/P5Background.jsx</a></li><li><a href="frontend_src_components_P5PropertiesContext.module_jsx.html">frontend/src/components/P5PropertiesContext.jsx</a></li><li><a href="frontend_src_components_PlayPauseButton.module_jsx.html">frontend/src/components/PlayPauseButton.jsx</a></li><li><a href="frontend_src_components_PostCard.module_jsx.html">frontend/src/components/PostCard.jsx</a></li><li><a href="frontend_src_components_PostListing.module_jsx.html">frontend/src/components/PostListing.jsx</a></li><li><a href="frontend_src_components_PremadeRuleCard.module_jsx.html">frontend/src/components/PremadeRuleCard.jsx</a></li><li><a href="frontend_src_components_PremadeRulesOptionsTabContainer.module_jsx.html">frontend/src/components/PremadeRulesOptionsTabContainer.jsx</a></li><li><a href="frontend_src_components_PrettyAlert.module_jsx.html">frontend/src/components/PrettyAlert.jsx</a></li><li><a href="frontend_src_components_ResizableGrid.module_jsx.html">frontend/src/components/ResizableGrid.jsx</a></li><li><a href="frontend_src_components_RightOptionsRootContainer.module_jsx.html">frontend/src/components/RightOptionsRootContainer.jsx</a></li><li><a href="frontend_src_components_SavePostInput.module_jsx.html">frontend/src/components/SavePostInput.jsx</a></li><li><a href="frontend_src_components_TopNavigationBar.module_jsx.html">frontend/src/components/TopNavigationBar.jsx</a></li><li><a href="frontend_src_components_ViewerOptionsTabContainer.module_jsx.html">frontend/src/components/ViewerOptionsTabContainer.jsx</a></li><li><a href="frontend_src_components_cellularAutomataSketch.module_js.html">frontend/src/components/cellularAutomataSketch.js</a></li><li><a href="frontend_src_pages_Community.module_jsx.html">frontend/src/pages/Community.jsx</a></li><li><a href="frontend_src_pages_Login.module_jsx.html">frontend/src/pages/Login.jsx</a></li><li><a href="frontend_src_pages_MyCA.module_jsx.html">frontend/src/pages/MyCA.jsx</a></li><li><a href="frontend_src_pages_Register.module_jsx.html">frontend/src/pages/Register.jsx</a></li><li><a href="frontend_src_pages_ViewerBuilderCreator.module_jsx.html">frontend/src/pages/ViewerBuilderCreator.jsx</a></li><li><a href="frontend_src_sketches_CellularAutomataSketchClass.module_js.html">frontend/src/sketches/CellularAutomataSketchClass.js</a></li></ul><h3>Classes</h3><ul><li><a href="TextureRuleCellularAutomataSketchClass.html">TextureRuleCellularAutomataSketchClass</a></li><li><a href="backend_src_postgreSQLConnect.module_js-PostgreSQLConnect.html">PostgreSQLConnect</a></li><li><a href="frontend_src_components_BackendRequester.module_js-BackendRequester.html">BackendRequester</a></li><li><a href="frontend_src_components_BinaryEncoderDecoder.module_js-BinaryEncoderDecoder.html">BinaryEncoderDecoder</a></li><li><a href="frontend_src_sketches_CellularAutomataSketchClass.module_js-CellularAutomataSketchClass.html">CellularAutomataSketchClass</a></li></ul><h3>Global</h3><ul><li><a href="global.html#LangPage">LangPage</a></li><li><a href="global.html#langCompiler">langCompiler</a></li><li><a href="global.html#translate_colors">translate_colors</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue Mar 12 2024 15:15:20 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
